---
layout: post
title: "Ruby mysql2 gem ì„¤ì¹˜ ì‹œ libssl ì˜¤ë¥˜ í•´ê²°ë²•"
date: 2019-07-24 15:00:00 +0900
tags:
  - Ruby
summary: "Ruby Bundlerë¡œ C extensionì´ ìˆëŠ” gemì„ ì»´íŒŒì¼ í•  ë•Œ compiler flag ì£¼ëŠ” ë°©ë²•ì„ ë‹¤ë£¹ë‹ˆë‹¤."
---

# Ruby mysql2 gem ì„¤ì¹˜ ì‹œ libssl ì˜¤ë¥˜ í•´ê²°ë²•

## Problem
mysql2 gem ì„¤ì¹˜ ê³¼ì •ì—ì„œ  `libssl` libraryê°€ ì—†ë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆë‹¤.

```
â¯â¯â¯ gem install mysql2
Building native extensions.  This could take a while...
ERROR:  Error installing mysql2:
        ERROR: Failed to build gem native extension.
(ìƒëµ)
ld: library not found for -lssl
clang: error: linker command failed with exit code 1 (use -v to see invocation)
make: *** [mysql2.bundle] Error 1

make failed, exit code 2
```

[[1]](https://stackoverflow.com/questions/30834421/error-when-trying-to-install-app-with-mysql2-gem) ì„ ì°¸ê³ í•´ `openssl` ì„ ë‹¤ì‹œ ì„¤ì¹˜í•´ë³´ë„ë¡ í•œë‹¤. `libssl` ì´ ì—†ëŠ”ë° ì™œ `openssl`ì„ ì„¤ì¹˜í•´ì•¼í•˜ëŠ” ì§€ ì´ìƒí–ˆëŠ”ë°,  [[2]](https://en.wikibooks.org/wiki/OpenSSL)ì— ë”°ë¥´ë©´ `openssl`ì´ `libssl`ì„ í¬í•¨í•œë‹¤.

> OpenSSL consists of two separate libraries: libcrypto and libssl. libcrypto is a general-purpose cryptography library which can be used alone. libssl is a TLS library which depends on libcrypto.

```
â¯â¯â¯ brew reinstall openssl && brew link openssl --force
(ì¤‘ëµ)
==> Summary
ğŸº  /usr/local/Cellar/openssl/1.0.2q: 1,794 files, 12.1MB
Warning: Refusing to link macOS-provided software: openssl
If you need to have openssl first in your PATH run:
  echo 'export PATH="/usr/local/opt/openssl/bin:$PATH"' >> ~/.zshrc

For compilers to find openssl you may need to set:
  export LDFLAGS="-L/usr/local/opt/openssl/lib"
  export CPPFLAGS="-I/usr/local/opt/openssl/include"

For pkg-config to find openssl you may need to set:
  export PKG_CONFIG_PATH="/usr/local/opt/openssl/lib/pkgconfig"
```

## Solution
[[1]](https://stackoverflow.com/questions/30834421/error-when-trying-to-install-app-with-mysql2-gem)ì˜ ë‹¤ë¥¸ ë‹µë³€ê³¼ [[3]](https://bundler.io/v1.13/man/bundle-config.1.html#BUILD-OPTIONS)ì„ ì°¸ê³ í•´ bundler ì— opensslì˜ ê²½ë¡œë¥¼ ì°¾ì„ ìˆ˜ ìˆë„ë¡ ì˜µì…˜ì„ ì¶”ê°€í•˜ê³  ë‹¤ì‹œ ì„¤ì¹˜í•œë‹¤.
```
$ bundle config --local build.mysql2 "--with-ldflags=-L/usr/local/opt/openssl/lib â€”with-cppflags=-I/usr/local/opt/openssl/include"
$ bundle
```

## Reference
1. [mysql - Error when trying to install app with mysql2 gem - Stack Overflow](https://stackoverflow.com/questions/30834421/error-when-trying-to-install-app-with-mysql2-gem)
2. [OpenSSL - Wikibooks, open books for an open world](https://en.wikibooks.org/wiki/OpenSSL)
3. [Bundler: bundle config](https://bundler.io/v1.13/man/bundle-config.1.html#BUILD-OPTIONS)
